---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';

// Fonction requise pour les routes dynamiques
export function getStaticPaths() {
  const products = {
    'aviateur-classique': {
      name: 'Aviateur Classique',
      category: 'business',
      price: 289,
      description: 'Lunettes aviateur personnalisables avec un style élégant et intemporel. Parfaites pour un usage quotidien avec une touche business sophistiquée.',
      images: ['/lunettes-default.svg', '/lunettes-default.svg', '/lunettes-default.svg'],
      specs: {
        'Style': 'Aviator Italian',
        'Type': 'DOC Model',
        'Taille verres': '38 mm',
        'Longueur branches': '145 mm'
      },
      includes: [
        'Étui de luxe offert',
        'Chiffon microfibre premium',
        'Certificat d\'authenticité et numérotation',
        'Garantie à vie'
      ]
    },
    'wayfarer-moderne': {
      name: 'Wayfarer Moderne',
      category: 'urbain',
      price: 249,
      description: 'Design moderne et urbain, parfait pour un style décontracté et tendance.',
      images: ['/lunettes-default.svg', '/lunettes-default.svg', '/lunettes-default.svg'],
      specs: {
        'Style': 'Wayfarer',
        'Type': 'Urban',
        'Taille verres': '40 mm',
        'Longueur branches': '143 mm'
      },
      includes: [
        'Étui de luxe offert',
        'Chiffon microfibre premium',
        'Certificat d\'authenticité et numérotation',
        'Garantie à vie'
      ]
    },
    'ronde-vintage': {
      name: 'Ronde Vintage',
      category: 'féminin',
      price: 279,
      description: 'Style vintage élégant avec une touche féminine raffinée.',
      images: ['/lunettes-default.svg', '/lunettes-default.svg', '/lunettes-default.svg'],
      specs: {
        'Style': 'Ronde',
        'Type': 'Vintage',
        'Taille verres': '42 mm',
        'Longueur branches': '140 mm'
      },
      includes: [
        'Étui de luxe offert',
        'Chiffon microfibre premium',
        'Certificat d\'authenticité et numérotation',
        'Garantie à vie'
      ]
    },
    'sport-performance': {
      name: 'Sport Performance',
      category: 'sport',
      price: 329,
      description: 'Conçues pour la performance sportive avec un design technique et léger.',
      images: ['/lunettes-default.svg', '/lunettes-default.svg', '/lunettes-default.svg'],
      specs: {
        'Style': 'Sport',
        'Type': 'Performance',
        'Taille verres': '45 mm',
        'Longueur branches': '148 mm'
      },
      includes: [
        'Étui de luxe offert',
        'Chiffon microfibre premium',
        'Certificat d\'authenticité et numérotation',
        'Garantie à vie'
      ]
    },
    'carree-minimaliste': {
      name: 'Carrée Minimaliste',
      category: 'business',
      price: 289,
      description: 'Design minimaliste et épuré pour un look professionnel.',
      images: ['/lunettes-default.svg', '/lunettes-default.svg', '/lunettes-default.svg'],
      specs: {
        'Style': 'Carrée',
        'Type': 'Minimaliste',
        'Taille verres': '41 mm',
        'Longueur branches': '142 mm'
      },
      includes: [
        'Étui de luxe offert',
        'Chiffon microfibre premium',
        'Certificat d\'authenticité et numérotation',
        'Garantie à vie'
      ]
    },
    'cat-eye-elegante': {
      name: 'Cat-Eye Élégante',
      category: 'féminin',
      price: 309,
      description: 'Style cat-eye élégant et sophistiqué pour une allure glamour.',
      images: ['/lunettes-default.svg', '/lunettes-default.svg', '/lunettes-default.svg'],
      specs: {
        'Style': 'Cat-Eye',
        'Type': 'Élégante',
        'Taille verres': '43 mm',
        'Longueur branches': '141 mm'
      },
      includes: [
        'Étui de luxe offert',
        'Chiffon microfibre premium',
        'Certificat d\'authenticité et numérotation',
        'Garantie à vie'
      ]
    }
  };

  return Object.keys(products).map(slug => ({
    params: { slug },
    props: { product: products[slug] }
  }));
}

const { product } = Astro.props;
---

<Layout title={`${product.name} - TaVue`}>
  <Header />
  
  <main class="pt-20">
    <!-- Bouton retour -->
    <section class="px-6 lg:px-10 py-6">
      <div class="container mx-auto">
        <a 
          href="/collection" 
          class="inline-flex items-center gap-2 text-gray-400 hover:text-yellow-500 transition-colors group"
        >
          <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          <span class="text-sm uppercase tracking-wide">Retour à la collection</span>
        </a>
      </div>
    </section>

    <!-- Section Hero Produit -->
    <section class="min-h-screen px-6 lg:px-10 py-20">
      <div class="container mx-auto">
        <div class="grid lg:grid-cols-2 gap-12 items-start">
          <!-- Images à gauche -->
          <div class="space-y-4">
            <!-- Image principale -->
            <div class="aspect-square rounded-2xl overflow-hidden border border-white/10 bg-zinc-900 flex items-center justify-center p-8">
              <img 
                src={product.images[0]} 
                alt={product.name}
                class="w-full h-full object-contain"
              />
            </div>
            
            <!-- Miniatures -->
            <div class="grid grid-cols-3 gap-4">
              {product.images.map((img: string, index: number) => (
                <div class="aspect-square rounded-lg overflow-hidden border border-white/10 bg-zinc-900 cursor-pointer hover:border-yellow-500/50 transition-colors flex items-center justify-center p-4">
                  <img 
                    src={img} 
                    alt={`${product.name} - vue ${index + 1}`}
                    class="w-full h-full object-contain"
                  />
                </div>
              ))}
            </div>
          </div>

          <!-- Informations à droite -->
          <div class="space-y-8 lg:sticky lg:top-24">
            <!-- Badge collection -->
            <span class="inline-block px-4 py-2 bg-yellow-500/10 border border-yellow-500/30 rounded-full text-yellow-500 text-sm">
              SÉRIE COLLECTION 2025
            </span>

            <!-- Titre -->
            <div>
              <h1 class="text-4xl lg:text-5xl font-light text-white mb-4">
                {product.name}
              </h1>
              <p class="text-gray-300 text-lg leading-relaxed">
                {product.description}
              </p>
            </div>

            <!-- Spécifications -->
            <div class="grid grid-cols-2 gap-4">
              {Object.entries(product.specs).map(([key, value]: [string, any]) => (
                <div class="bg-zinc-900 border border-white/10 rounded-lg p-4">
                  <p class="text-gray-400 text-sm">{key}</p>
                  <p class="text-white font-light">{value}</p>
                </div>
              ))}
            </div>

            <!-- Inclus -->
            <div class="bg-zinc-900/50 border border-white/10 rounded-xl p-6 space-y-3">
              <h3 class="text-yellow-500 font-serif text-lg mb-4">INCLUS</h3>
              {product.includes.map((item: string) => (
                <div class="flex items-center gap-3">
                  <svg class="w-5 h-5 text-yellow-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <span class="text-gray-300 text-sm">{item}</span>
                </div>
              ))}
            </div>

            <!-- Prix et actions -->
            <div class="space-y-4">
              <div class="flex items-baseline gap-2">
                <span class="text-yellow-500 text-5xl font-serif">{product.price} €</span>
              </div>
              
              <div class="flex gap-4">
                <a 
                  href="/personnalisation"
                  class="btn btn-outline btn-warning flex-1 hover:bg-yellow-500 hover:text-black transition-colors"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
                  </svg>
                  PERSONNALISER
                </a>
                <button 
                  id="addToCartBtn"
                  data-product-name={product.name}
                  data-product-price={product.price}
                  class="btn btn-warning flex-1 bg-yellow-500 hover:bg-yellow-400 text-black border-none"
                >
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                  </svg>
                  COMMANDER
                </button>
              </div>

              <!-- Livraison -->
              <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 flex items-center gap-3">
                <svg class="w-6 h-6 text-yellow-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                </svg>
                <div>
                  <p class="text-yellow-500 font-serif text-sm">LIVRAISON SOIGNÉE - 2-3 JOURS</p>
                  <p class="text-gray-400 text-xs">Emballage premium, suivi pas à pas</p>
                </div>
              </div>

              <!-- Logo de paiement -->
              <p class="text-center text-gray-500 text-xs pt-4">
                Paiement sécurisé
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Section savoir-faire -->
    <section class="py-20 px-6 lg:px-10 bg-zinc-900/30">
      <div class="container mx-auto">
        <h2 class="text-3xl lg:text-4xl font-light text-yellow-500 font-serif text-center mb-12">
          Notre savoir-faire
        </h2>
        <div class="grid md:grid-cols-3 gap-8">
          <div class="text-center space-y-4">
            <div class="aspect-video rounded-lg overflow-hidden border border-white/10 bg-zinc-900 flex items-center justify-center p-6">
              <img src="/lunettes-default.svg" alt="Artisanat" class="w-full h-full object-contain"/>
            </div>
            <h3 class="text-yellow-500 font-serif">ARTISANAT</h3>
            <p class="text-gray-400 text-sm">Fabriqué à la main par nos artisans français</p>
          </div>
          <div class="text-center space-y-4">
            <div class="aspect-video rounded-lg overflow-hidden border border-white/10 bg-zinc-900 flex items-center justify-center p-6">
              <img src="/lunettes-default.svg" alt="Matériaux" class="w-full h-full object-contain"/>
            </div>
            <h3 class="text-yellow-500 font-serif">MATÉRIAUX</h3>
            <p class="text-gray-400 text-sm">Les meilleurs matériaux sélectionnés</p>
          </div>
          <div class="text-center space-y-4">
            <div class="aspect-video rounded-lg overflow-hidden border border-white/10 bg-zinc-900 flex items-center justify-center p-6">
              <img src="/lunettes-default.svg" alt="Excellence" class="w-full h-full object-contain"/>
            </div>
            <h3 class="text-yellow-500 font-serif">EXCELLENCE</h3>
            <p class="text-gray-400 text-sm">Contrôle qualité rigoureux</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="border-t border-white/10 py-12 px-6 lg:px-10">
    <div class="container mx-auto text-center space-y-6">
      <nav class="flex justify-center gap-6 text-sm text-gray-400">
        <a href="/mentions-legales" class="hover:text-yellow-500 transition-colors">Mentions légales</a>
        <span class="text-white/20">|</span>
        <a href="/cgv" class="hover:text-yellow-500 transition-colors">CGV</a>
        <span class="text-white/20">|</span>
        <a href="/contact" class="hover:text-yellow-500 transition-colors">Contact</a>
      </nav>
      <p class="text-yellow-500 font-serif text-sm">
        Fabrication française – Artisanat d'excellence
      </p>
    </div>
  </footer>

  <script>
    // Ajouter au panier
    document.getElementById('addToCartBtn')?.addEventListener('click', (e) => {
      const btn = e.currentTarget as HTMLButtonElement;
      const productName = btn.dataset.productName || '';
      const productPrice = parseInt(btn.dataset.productPrice || '0');

      // Récupérer le panier
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      
      // Ajouter l'article
      cart.push({
        modelName: productName,
        price: productPrice,
        date: new Date().toISOString()
      });
      
      // Sauvegarder
      localStorage.setItem('cart', JSON.stringify(cart));
      
      // Rediriger vers le panier
      window.location.href = '/panier';
    });
  </script>
</Layout>
