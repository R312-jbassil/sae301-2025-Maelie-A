---
import Layout from "../../layouts/Layout.astro";
import { pb } from "../../lib/pocketbase.ts";
import { ui } from "../../i18n/ui.js";

const locale = (Astro.locals.lang as "en" | "fr") ?? "en";
const t = ui[locale];

// Récupérer tous les SVG sauvegardés
let svgs = [];
try {
  const records = await pb.collection("SVG").getList(1, 50, {
    sort: "-created",
  });
  svgs = records.items;
} catch (error) {
  console.error("Erreur lors du chargement des SVG:", error);
}
---

<Layout title={t.gallery?.title || "Galerie SVG"}>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-8">{t.gallery?.title || "Galerie SVG"}</h1>
    
    {svgs.length === 0 ? (
      <div class="alert alert-info">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>{locale === "fr" ? "Aucun SVG sauvegardé pour le moment." : "No saved SVG yet."}</span>
      </div>
    ) : (
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {svgs.map((svg: any) => (
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h2 class="card-title">{svg.title || "Sans titre"}</h2>
              <div class="bg-base-200 p-4 rounded-lg aspect-square flex items-center justify-center">
                <div set:html={svg.code_svg} class="max-w-full max-h-full" />
              </div>
              <div class="card-actions justify-end mt-4">
                <a href={`/gallery/${svg.id}`} class="btn btn-primary btn-sm">
                  {t.gallery?.viewDetails || "Voir détails"}
                </a>
              </div>
              <div class="text-xs opacity-60 mt-2">
                {new Date(svg.created).toLocaleDateString(locale)}
              </div>
            </div>
          </div>
        ))}
      </div>
    )}
  </div>
</Layout>
